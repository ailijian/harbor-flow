# HarborFlow Development Diary

- Date: 2025-11-21
- Type: feature
- Modules: `harborflow/types.py`, `harborflow/decorators.py`, `harborflow/compile.py`, `harborflow/__init__.py`
- Summary: 引入核心骨架与公共 API，建立最小可用版本与示例/测试。
- Reason: 对齐《harbor-flow实现设计 V1.0.0.md》，提供声明式图编排的基础能力。
- Changes:
  - 定义 `Route` 与 `END` 二次导出，补充基础异常类型。
  - 提供 `@node` 与 `@graph` 装饰器、`GraphConfig` 并注入 `compile()`。
  - 实现 `compile_graph`：节点收集、返回值适配、顺序链与 START/END。
  - 添加最小示例 `examples/simple_chat.py` 与单测 `tests/test_types.py`、`tests/test_compile.py`。
- Breaking: 否
- Related: N/A

- Date: 2025-11-24
- Type: chore
- Modules: `examples/advanced_features_demo.py`, `README.md`, `harborflow/__init__.py`, `pyproject.toml`
- Summary: 发布 v0.1.3 版本，标准化所有 Route 返回格式，统一代码示例风格。
- Reason: 提高代码一致性和可读性，为发布到 PyPI 做准备。
- Changes:
  - 更新版本号到 0.1.3（`pyproject.toml` 和 `harborflow/__init__.py`）。
  - 标准化 `examples/advanced_features_demo.py` 中所有 Route 返回语句，统一使用 `Route(goto=..., update=...)` 格式。
  - 更新 `README.md` 中的代码示例，保持一致的风格。
  - 创建发布说明文档 `RELEASE_NOTES_v0.1.3.md`。
  - 所有测试继续通过（14/14），功能完全保持向后兼容。
- Breaking: 否
- Related: PyPI 发布准备

- Date: 2025-11-21
- Type: chore
- Modules: `harborflow/compile.py`, `harborflow/decorators.py`
- Summary: 为 `compile_graph` 增加 `check` 形参并在 Docstring 对齐契约；补充 `graph` Docstring 说明透传。
- Reason: 与设计文档的 API 形签一致，预留校验开关，保持当前行为等价。
- Changes:
  - `compile_graph(flow_instance, *, check: bool = True, **compile_options)` 签名更新；Docstring 增补 `check` 说明。
  - `graph` Docstring 增补：注入的 `compile(self, **options)` 透传到 `compile_graph`，包含 `check`。
- Breaking: 否
- Related: N/A

- Date: 2025-11-21
- Type: chore
- Modules: `tests/test_compile.py`, `tests/test_types.py`, `tests/conftest.py`, `requirements.txt`, `pyproject.toml`
- Summary: 扩充 Command 与 with_update 的集成测试，并声明依赖以保障本地/CI一致。
- Reason: 提高行为覆盖与稳定性，确保开发与CI环境一致安装运行。
- Changes:
  - 扩充 `tests/test_compile.py`：新增 `test_command_direct_return` 与 `test_route_with_update_chain`。
  - 添加 `tests/conftest.py`：在未安装 `langgraph` 时跳过测试并设置项目根路径。
  - 添加 `requirements.txt`：声明 `langgraph>=1.0.0` 与 `pytest>=7.0.0`。
  - 添加 `pyproject.toml`：声明项目基础信息与依赖（PEP 621）。
- Breaking: 否
- Related: N/A

- Date: 2025-11-24
- Type: feature
- Modules: `harborflow/types.py`, `harborflow/decorators.py`, `harborflow/compile.py`, `harborflow/types_additions.py`, `harborflow/__init__.py`
- Summary: 实现异步支持、类型注解修复、错误处理增强、状态验证、条件路由和并行执行等六大优化。
- Reason: 响应用户需求，将 HarborFlow 升级为具备现代异步工作流引擎能力的完整框架。
- Changes:
  - **异步支持**：添加 `@node` 装饰器对异步函数的支持，创建 `compile_graph_async()` 和 `_wrap_node_async()`。
  - **类型注解修复**：使用 `ParamSpec` 和 `TypeVar` 保持装饰器类型签名，确保类型安全。
  - **错误处理增强**：创建 `NodeExecutionError` 和 `NodeConfig` 类，支持超时、重试和自定义错误处理。
  - **状态验证**：实现 `validate_state_transition()` 函数，支持必需字段和不可变字段验证。
  - **条件路由**：创建 `ConditionalRoute` 类，支持基于条件的动态路由和优先级系统。
  - **并行执行**：创建 `@parallel_node` 装饰器，为并行执行框架奠定基础。
  - 添加完整测试套件 `tests/test_async_features.py` 和功能演示 `examples/advanced_features_demo.py`。
- Breaking: 否（保持完全向后兼容）
- Related: N/A